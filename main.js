(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-9",headers:{authorization:"2819a494-090d-4234-b0dd-7e1c5f7ea63a","Content-Type":"application/json"}},t=function(t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},n=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},o=function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function r(e,t){return e.findIndex((function(e){return e._id===t}))}function c(e,t,n){e.classList.remove(n.inputErrorClass),t.classList.remove(n.errorClass),t.textContent=""}function i(e,t){e.classList.add(t.inactiveButtonClass),e.setAttribute("disabled",!0)}function a(e,t){e.reset();var n=e.querySelector(t.submitButtonSelector);e.querySelectorAll(t.inputSelector).forEach((function(n){c(n,e.querySelector("#".concat(n.name,"-error")),t)})),i(n,t)}function u(e){e.classList.add("popup_opened");var t=e.querySelector(".close-button"),n=function(t){!function(e,t){"Escape"===e.key&&(t.classList.remove("popup_opened"),document.removeEventListener("keydown",t.escCloseHandler))}(t,e)};e.escCloseHandler=n,document.addEventListener("keydown",n),t.addEventListener("click",(function(){s(e)})),e.addEventListener("click",(function(t){t.target.classList.contains("popup_opened")&&function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",e.escCloseHandler)}(e)}))}function s(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",e.escCloseHandler)}function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){var o;return o=function(e,t){if("object"!=l(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,"string");if("object"!=l(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==l(o)?o:String(o))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var m,y,v={formSelector:".popup__form",inputSelector:".popup__text",submitButtonSelector:".popup__save-button",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__text_error",errorClass:"popup__error_visible"},h=document.querySelector(".profile__edit"),b=document.querySelector(".profile__add-button"),_=document.querySelector("#editPopup #name"),S=document.querySelector("#editPopup #job"),g=document.querySelector("#editPopup"),k=document.querySelector("#popupAddCard"),C=document.querySelector("#previewPopup"),q=document.querySelector("#popupUpdateAvatar"),L=document.querySelector(".photo-gallery"),j=document.querySelector(".profile__avatar"),E=document.querySelector(".profile__name"),P=document.querySelector(".profile__description");function x(e,c){return function(e,c,i,a){var u=document.querySelector(e).content.cloneNode(!0).children[0],s=u.querySelector(".photo-gallery__image"),l=u.querySelector(".photo-gallery__description"),d=u.querySelector(".photo-gallery__remove-button"),p=c.likes,f=u.querySelector(".photo-gallery__like-counter-button"),m=u.querySelector(".photo-gallery__like-counter-button_count"),y=c.name,v=c.link,h=c.owner._id;return s.addEventListener("click",(function(){a({name:y,link:v})})),h!=i&&d.classList.add("photo-gallery__remove-button_hide"),p.length>0&&(m.textContent=p.length),r(p,i)>=0&&f.classList.add("photo-gallery__like-counter-button_active"),function(e,t,n){e.src=n.link,e.alt=n.name,t.textContent=n.name}(s,l,c),function(e,c,i,a,u,s){e.addEventListener("click",(function(){return function(e,t,c,i,a){-1===r(e.likes,t)?n(e._id).then((function(t){e.likes=t.likes,a.textContent=e.likes.length,i.classList.add("photo-gallery__like-counter-button_active")})).catch((function(e){console.log(e)})):o(e._id).then((function(t){e.likes=t.likes,0===e.likes.length?a.textContent="":a.textContent=e.likes.length,i.classList.remove("photo-gallery__like-counter-button_active")})).catch((function(e){console.log(e)}))}(i,a,0,e,s)})),c.addEventListener("click",(function(){return function(e,n){t(e._id).then((function(){n.remove(),n=null})).catch((function(e){console.log(e)}))}(i,u)}))}(f,d,c,i,u,m),u}("#cards",e,c,w)}function O(e,t){e.addEventListener("submit",(function(n){n.preventDefault(),t(function(e){var t=e.querySelector(".popup__form");return Array.from(t.querySelectorAll("input")).reduce((function(e,t){return p(p({},e),{},f({},t.name,t.value))}),{})}(e),e)}))}function w(e){u(C);var t=C.querySelector(".popup-card__image"),n=C.querySelector(".popup-card__title");t.src=e.link,n.textContent=e.name,n.alt=e.name}Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))]).then((function(e){console.log(e),m=e[0]._id,console.log(m),j.style.backgroundImage='url("'.concat(e[0].avatar,'")'),E.textContent=e[0].name,P.textContent=e[0].about,function(e,t){var n=e.renderer;e.items.forEach((function(e){var o=n(e);t.append(o)}))}({items:e[1],renderer:function(e){return x(e,m)}},L)})).catch((function(e){console.log(e)})),y=v,document.querySelectorAll(y.formSelector).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()}));var t=e.querySelector(y.submitButtonSelector);i(t,y),e.querySelectorAll(y.inputSelector).forEach((function(n){n.addEventListener("input",(function(){!function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity("");var r=t.validity.valid,a=e.querySelector("#".concat(t.name,"-error"));r?c(t,a,n):function(e,t,n){e.classList.add(n.inputErrorClass),t.classList.add(n.errorClass),t.textContent=e.validationMessage}(t,a,n),e.checkValidity()?function(e,t){e.classList.remove(t.inactiveButtonClass),e.removeAttribute("disabled")}(o,n):i(o,n)}(e,n,y,t)}))}))})),h.addEventListener("click",(function(){a(g.querySelector(".popup__form"),v),u(g);var e=function(e){var t=e.profileDescription;return{name:e.profileName.textContent,description:t.textContent}}({profileName:E,profileDescription:P}),t=e.name,n=e.description;_.value=t,S.value=n})),O(g,(function(t){var n=document.querySelector("#edit-save-button");n.textContent="Сохранение...",function(t){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t.personalName,about:t.qualification})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t).then((function(e){var t,o,r;n.textContent="Сохранить",o=(t={name:e.name,description:e.about}).name,r=t.description,E.textContent=o,P.textContent=r,s(g)})).catch((function(e){console.log(e)}))})),b.addEventListener("click",(function(){u(k),a(k.querySelector(".popup__form"),v)})),O(k,(function(t){var n,o,r=document.querySelector("#add-save-button");r.textContent="Сохранение...",(n=t.cardTitle,o=t.cardLink,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){r.textContent="Создать";var t=x(e,m);L.prepend(t),s(k)})).catch((function(e){console.log(e)}))})),j.addEventListener("click",(function(){u(q),a(q.querySelector(".popup__form"),v)})),O(q,(function(){var t,n=document.querySelector("#update-save-button");n.textContent="Сохранение...",(t=document.querySelector("#avatarRef").value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){n.textContent="Сохранить",j.style.backgroundImage='url("'.concat(e.avatar,'")'),s(q)})).catch((function(e){console.log(e)}))}))})();